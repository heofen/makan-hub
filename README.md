# Музыкальный стриминг на Django

Проект музыкального стриминга, созданный с использованием Django и Django REST Framework.

## Функциональность

- Управление исполнителями, альбомами и треками
- Пользовательская система с ролями (пользователь/администратор)
- REST API для взаимодействия с музыкальной библиотекой
- Загрузка и воспроизведение аудиофайлов
- Административная панель для управления контентом
- Рекомендации похожих треков на основе векторных представлений

## Требования

- Python 3.x
- Django 5.2
- Django REST Framework 3.16.0
- Pillow 11.2.1
- PostgreSQL (основная база данных)
- MongoDB (для хранения векторных представлений треков)
- psycopg2-binary
- pymongo
- django-environ

## Установка

1. Клонировать репозиторий:
```
git clone <url-репозитория>
cd music_streaming
```

2. Создать виртуальное окружение и активировать его:
```
python -m venv venv
source venv/bin/activate  # На Linux/Mac
# или
venv\Scripts\activate  # На Windows
```

3. Установить зависимости:
```
pip install -r requirements.txt
```

4. Настройка баз данных:

### PostgreSQL

Установите PostgreSQL, если он еще не установлен:
```
# Ubuntu/Debian
sudo apt-get install postgresql postgresql-contrib

# MacOS с Homebrew
brew install postgresql
```

Создайте базу данных и пользователя:
```
sudo -u postgres psql

postgres=# CREATE DATABASE music_streaming;
postgres=# CREATE USER music_user WITH PASSWORD 'password';
postgres=# GRANT ALL PRIVILEGES ON DATABASE music_streaming TO music_user;
```

### MongoDB

Установите MongoDB, если он еще не установлен:
```
# Ubuntu/Debian
sudo apt-get install mongodb

# MacOS с Homebrew
brew install mongodb-community
```

Запустите MongoDB:
```
# Ubuntu/Debian
sudo systemctl start mongodb

# MacOS
brew services start mongodb-community
```

5. Настройка переменных окружения:

Создайте файл `.env` в корне проекта со следующим содержимым (замените значения на свои):
```
# PostgreSQL
POSTGRES_NAME=music_streaming
POSTGRES_USER=music_user
POSTGRES_PASSWORD=password
POSTGRES_HOST=localhost
POSTGRES_PORT=5432

# MongoDB
MONGO_URI=mongodb://localhost:27017/
MONGO_DB=music_vectors
```

6. Выполнить миграции базы данных:
```
python manage.py migrate
```

7. Создать суперпользователя (администратора):
```
python manage.py createsuperuser
```

## Запуск

```
python manage.py runserver
```

После запуска сервера, доступ к различным частям приложения будет по следующим адресам:

- Административная панель: http://127.0.0.1:8000/admin/
- API: http://127.0.0.1:8000/api/
- API авторизация: http://127.0.0.1:8000/api-auth/

## API эндпоинты

### Музыкальная библиотека
- `/api/artists/` - список артистов
  - Поддерживаемые параметры:
    - `name` - поиск по имени исполнителя
    - `genre` - фильтрация по жанру
    - `country` - фильтрация по стране
    - `verified` - фильтрация верифицированных исполнителей (true/false)
  - Дополнительные эндпоинты:
    - `/api/artists/{slug}/` - детальная информация об исполнителе
    - `/api/artists/{slug}/albums/` - список альбомов исполнителя
    - `/api/artists/{slug}/tracks/` - список треков исполнителя
- `/api/albums/` - список альбомов
  - Поддерживаемые параметры:
    - `artist_id` - альбомы определенного артиста
    - `year` - фильтрация по году выпуска
    - `year_from` / `year_to` - фильтрация по диапазону лет
    - `genre` - фильтрация по жанру
    - `title` - поиск по названию альбома
  - Дополнительные эндпоинты:
    - `/api/albums/{slug}/` - детальная информация об альбоме
    - `/api/albums/{slug}/tracks/` - список треков альбома
- `/api/tracks/` - список треков
  - Поддерживаемые параметры:
    - `album_id` - треки определенного альбома
    - `artist_id` - треки определенного артиста

Рекомендации:
- `/api/tracks/{id}/recommendations/` - получить рекомендации похожих треков
- `/api/tracks/{id}/process_vector/` - принудительно обработать вектор трека (только для администраторов)

### Пользователи
- `/api/users/` - список пользователей (только для администраторов)
- `/api/users/{id}/` - детали пользователя (для владельца аккаунта и администраторов)
- `/api/users/me/` - информация о текущем пользователе
- `/api/users/{id}/set_role/` - установка роли пользователя (только для администраторов)

## Пользовательские роли

В системе предусмотрены следующие роли пользователей:

1. **Обычный пользователь** (`user`)
   - Может просматривать музыкальный контент
   - Может управлять своим профилем
   - Может получать рекомендации

2. **Администратор** (`admin`)
   - Имеет все права обычного пользователя
   - Может управлять всем контентом (треки, альбомы, исполнители)
   - Может управлять пользователями
   - Может назначать роли другим пользователям

## Модели данных

### Исполнитель (Artist)

Модель представляет музыкального исполнителя или группу.

**Поля:**
- `name` - имя исполнителя
- `slug` - URL-дружественный идентификатор (генерируется автоматически)
- `bio` - биография или описание
- `image` - изображение исполнителя
- `genres` - жанры (строка с жанрами через запятую)
- `country` - страна происхождения
- `website` - официальный веб-сайт
- `is_verified` - статус верификации аккаунта
- `created_at` - дата создания
- `updated_at` - дата обновления

**Методы и свойства:**
- `genres_list` - список жанров (разделенных по запятой)
- `albums_count` - количество альбомов исполнителя
- `tracks_count` - количество треков исполнителя

### Альбом (Album)

Модель представляет музыкальный альбом.

**Поля:**
- `title` - название альбома
- `slug` - URL-дружественный идентификатор (генерируется автоматически)
- `artist` - исполнитель (связь ForeignKey с моделью Artist)
- `release_year` - год выпуска альбома
- `cover_image` - обложка альбома
- `description` - описание альбома
- `genre` - основной жанр альбома
- `release_date` - точная дата выпуска (опционально)
- `created_at` - дата создания записи
- `updated_at` - дата обновления записи

**Методы и свойства:**
- `tracks_count` - количество треков в альбоме

### Трек (Track)

Модель представляет музыкальный трек.

**Поля:**
- `title` - название трека
- `slug` - URL-дружественный идентификатор (генерируется автоматически)
- `artist` - исполнитель (связь ForeignKey с моделью Artist)
- `album` - альбом (связь ForeignKey с моделью Album)
- `audio_file` - аудиофайл трека
- `cover_image` - обложка трека (если отличается от обложки альбома)
- `duration` - длительность трека
- `genre` - жанр трека
- `lyrics` - текст песни
- `track_number` - номер трека в альбоме
- `is_featured` - отмечен ли трек как хит
- `is_explicit` - содержит ли трек ненормативный контент
- `created_at` - дата создания записи
- `updated_at` - дата обновления записи

**Методы и свойства:**
- `album_title` - название альбома
- `artist_name` - имя исполнителя 